<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map-canvas { height: 100% }
    </style>
    <script type="text/javascript"
      src="http://maps.googleapis.com/maps/api/js?sensor=false">
    </script>
    <script type="text/javascript">
      var asal = null;
      var tujuan = null;

      PilihAsalTujuanControl.prototype.toggleAsal = true;
      
      function PilihAsalTujuanControl(controlDiv, map) {
        var control = this;

        // Set CSS styles for the DIV containing the control
        // Setting padding to 5 px will offset the control
        // from the edge of the map
        controlDiv.style.padding = '5px';

        // Set CSS for the control border
        var controlUI = document.createElement('div');
        controlUI.style.backgroundColor = 'white';
        controlUI.style.borderStyle = 'solid';
        controlUI.style.borderWidth = '1px';
        controlUI.style.cursor = 'pointer';
        controlUI.style.textAlign = 'center';
        controlUI.title = 'Klik untuk berubah antara memilih titik asal dan titik tujuan';
        controlDiv.appendChild(controlUI);

        // Set CSS for the control interior
        var controlText = document.createElement('div');
        controlText.style.fontFamily = 'Arial,sans-serif';
        controlText.style.fontSize = '16px';
        controlText.style.paddingLeft = '4px';
        controlText.style.paddingRight = '4px';
        controlText.innerHTML = '<b>Memilih asal</b>';
        controlUI.appendChild(controlText);

        // Setup the click event listeners: simply set the map to
        // Chicago
        google.maps.event.addDomListener(controlUI, 'click', function() {
          if (!control.toggleAsal) {
            control.toggleAsal = true;
            controlText.innerHTML = '<b>Memilih asal</b>';
          }
          else {
            control.toggleAsal = false;
            controlText.innerHTML = '<b>Memilih tujuan</b>';
          }
        });

        google.maps.event.addListener(map, 'click', function(e) {
          if (control.toggleAsal) {
            if (asal != null) {
              asal.setMap(null);
              asal = null;
            }
            asal = new google.maps.Marker({
              position: e.latLng,
              map: map,
              animation: google.maps.Animation.DROP,
            });
            console.log("Asal: " + asal.getPosition().lng() + " " + asal.getPosition().lat());
          } else {
            if (tujuan != null) {
              tujuan.setMap(null);
              tujuan = null;
            }
            tujuan = new google.maps.Marker({
              position: e.latLng,
              map: map,
              animation: google.maps.Animation.DROP,
            });
            console.log("Tujuan: " + tujuan.getPosition().lng() + " " + tujuan.getPosition().lat());
          }
        })
      }

      function initialize() {
        var itebe = new google.maps.LatLng(-6.892578,107.610397);
        var mapOptions = {
          center: itebe,
          zoom: 15,
          streetViewControl: false,
        };
        var map = new google.maps.Map(document.getElementById("map-canvas"),
            mapOptions);

        // Create the DIV to hold the control and
        // call the HomeControl() constructor passing
        // in this DIV.
        var pilihAsalTujuanControlDiv = document.createElement('div');
        var pilihAsalTujuanControl = new PilihAsalTujuanControl(pilihAsalTujuanControlDiv, map);
        pilihAsalTujuanControlDiv.index = 1;
        map.controls[google.maps.ControlPosition.RIGHT_TOP].push(pilihAsalTujuanControlDiv);

        var GeoJson = {"type":"LineString","coordinates":[[107.6045,-6.88511],[107.60399,-6.88701],[107.60396,-6.88713],[107.60393,-6.88778],[107.60399,-6.88822],[107.60403,-6.8886],[107.60419,-6.89008],[107.60419,-6.8901],[107.60421,-6.89061],[107.60423,-6.89116],[107.60423,-6.89125],[107.60424,-6.89151],[107.60424,-6.89164],[107.60424,-6.89176],[107.60423,-6.89239],[107.60423,-6.89252],[107.60415,-6.89334],[107.60407,-6.89404],[107.60401,-6.89482],[107.60402,-6.89507],[107.60395,-6.89554],[107.60395,-6.89561],[107.60394,-6.89568],[107.60394,-6.89572],[107.60393,-6.89595],[107.60392,-6.89657],[107.60394,-6.89721],[107.60394,-6.89722],[107.60401,-6.89849],[107.60406,-6.89905],[107.60408,-6.89943],[107.60411,-6.89985],[107.60414,-6.90014],[107.60415,-6.9002],[107.60415,-6.90021],[107.60415,-6.90023],[107.60416,-6.90027],[107.60416,-6.90029],[107.60416,-6.90031],[107.60418,-6.90039],[107.60424,-6.90089],[107.60425,-6.90093],[107.60428,-6.90154],[107.60429,-6.90179],[107.6043,-6.90231],[107.60437,-6.9039],[107.60439,-6.90432],[107.60455,-6.90431],[107.60477,-6.90428],[107.60478,-6.90428],[107.60488,-6.90426],[107.60493,-6.90424],[107.60504,-6.9042],[107.60504,-6.90417],[107.60505,-6.90415],[107.60507,-6.90413],[107.60521,-6.90406],[107.60531,-6.90403],[107.60538,-6.90401],[107.60551,-6.90399],[107.60568,-6.90396],[107.60586,-6.90399],[107.60603,-6.90404],[107.60625,-6.90411],[107.60639,-6.90417],[107.60641,-6.90418],[107.6066,-6.90429],[107.60671,-6.90436],[107.60685,-6.90447],[107.60695,-6.90455],[107.60699,-6.90459],[107.60717,-6.90478],[107.60724,-6.90485],[107.60731,-6.90496],[107.6074,-6.90509],[107.60744,-6.90516],[107.60758,-6.90548],[107.60768,-6.90575],[107.60774,-6.90605],[107.60777,-6.90626],[107.60787,-6.90648],[107.60835,-6.90661],[107.60841,-6.90662],[107.60889,-6.90671],[107.60934,-6.90679],[107.60939,-6.90679],[107.60968,-6.90684],[107.61053,-6.90699],[107.61063,-6.907],[107.61117,-6.90703],[107.61138,-6.90704],[107.6116,-6.90706],[107.61176,-6.90707],[107.61182,-6.90707],[107.61183,-6.90707],[107.61215,-6.90708],[107.61239,-6.90708],[107.61251,-6.90707],[107.61264,-6.90706],[107.61283,-6.90702],[107.61307,-6.90691],[107.61337,-6.90674],[107.61353,-6.90666],[107.61368,-6.9066],[107.61379,-6.90656],[107.61388,-6.90653],[107.61401,-6.90651],[107.61418,-6.9065],[107.61441,-6.90649],[107.61535,-6.9064],[107.61572,-6.90634],[107.61577,-6.90633],[107.61672,-6.9062],[107.61681,-6.90619],[107.61682,-6.90619],[107.61711,-6.90618],[107.61777,-6.90612],[107.61786,-6.90612],[107.6179,-6.90611],[107.618484387918,-6.90606934692743]]}

        // --- kode dibawah untuk menampilkan hasil query postgis berbentuk GeoJSON ---

        var lineStringCoords = [];
        for (var i = 0; i < GeoJson.coordinates.length; i++) {
          lineStringCoords.push(new google.maps.LatLng(GeoJson.coordinates[i][1], GeoJson.coordinates[i][0]));
        };
        var lineString = new google.maps.Polyline({
          path: lineStringCoords,
          map: map,
          strokeColor: '#FF0000',
          strokeOpacity: 1.0,
          strokeWeight: 2
        })
      }

      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </head>
  <body>
    <div id="map-canvas" />
  </body>
</html>